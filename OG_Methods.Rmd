---
title: "Methods_Data_Collection"
author: "Annie Kellner"
date: "2023-08-29"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r load libraries}

library(tidyverse)
library(here)
library(sf)
library(adehabitatLT)
library(tmap)
library(tmaptools)
library(knitr)
library(conflicted)

conflicts_prefer(
  dplyr::filter(),
  dplyr::select()
)
```
## Data Collection

```{r load-data}

# Bears

b <- readRDS(here("Data", "Derived-data", "DFs", "OG", "OG_090323.Rds"))

# GPS Data

fix <- readRDS(here("Data", "Derived-data", "DFs", "OG", "Fix_Rates.Rds"))

```

*For Data Collection paragraph:* 

# Bear IDs and Years

```{r ids-and-years}

table(b$animal, b$year)
length(unique(b$id)) # bear-summers
length(unique(b$animal))

```

* 25 bear years
* 23 individuals
* 2 bears with two years of data

# Tracking data

```{r adehabitatLT}

b <- as.data.frame(b)

ltraj <- as.ltraj(b[,c("Xaa","Yaa")], date=b$datetime, id=b$id, typeII = TRUE)

summary <- summary(ltraj)

summary$DaysTrack <-round(difftime(summary$date.end, summary$date.begin, units="days"),digits=1)

summary <- summary %>%
  select(id, date.begin, date.end, DaysTrack) %>%
  mutate(year = year(date.begin)) %>%
  mutate(DaysTrack = as.numeric(DaysTrack)) %>%
  arrange(year) 

summary(summary)

sd(summary$DaysTrack)
```

LATER: Can check whether missed fixes appear to be related to habitat variables. For now, say they aren't

```{r study-window}

start <- b %>%
  group_by(id) %>%
  slice_head()

summary(start)
sd(start$ordinal_date)

end <- b %>%
  group_by(id) %>%
  slice_tail()

summary(end)
sd(end$ordinal_date)
```

```{r bear-categories}

lf <- b %>%
  filter(landfall == 1)

l <- b %>%
  group_by(id) %>%
  slice_head() %>%
  filter(landfall == 0)

filter(b, departure_to_ice == 1)
filter(b, enter_den == 1)

```

# GPS Fix Rate Data

```{r}

fix$median <- round(fix$median, digits = 0)

table(fix$median)

```

