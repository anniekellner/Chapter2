---
title: "Space_Use_Summaries_Ch2"
author: "Annie Kellner"
date: "2022-09-15"
output: html_document
---

```{r setup, include=FALSE, message=FALSE}

library(knitr)
library(dplyr)
library(sf)
library(tmap)
library(tmaptools)

rm(list = ls())

knitr::opts_chunk$set(echo = FALSE)

```

# Basic summary tables for bears that visit the bonepile and those that do not

## How many bears visit the bonepile and how many do not?

Hereafter, bears that visit the bonepile are called "Bonepile" bears. Bears that do not are called "Natural" bears. 


```{r load-and-prep-data, include=FALSE}

pb <- readRDS('./Data/Derived-data/DFs/bears_ch2_092122.Rds')

pb2 <- pb %>%
  mutate(bear_type = case_when(
    id == "pb_32255.2008" | id == "pb_21237.2011" | id == "pb_20418.2005" | 
      id == "pb_20414.2009" ~ "Do Not Visit Bonepile",
    TRUE ~ "Visit Bonepile"
  ))

# Individual bears

ind <- pb2 %>%
  group_by(id) %>%
  slice_head() 

kable(table(ind$bear_type), col.names = NULL)

```

# How much time do bears spend at the bonepile (in days)?

```{r}

bpt <- readRDS('./Data/Derived-data/DFs/Space_Use_Summaries/time_at_bonepile.Rds')

## To get summary of time spent, have to add 20735's stints together and remove second entry

bpt$time_spent <- as.numeric(bpt$time_spent)
bpt[17,4] <- sum(bpt[17,4] + bpt[18,4])

bpt[-18,] -> bpt

summary(bpt$time_spent)

```

# How much time do bears spend along the coastal corridor (in days)?

```{r}

cor <- readRDS('./Data/Derived-data/DFs/Space_Use_Summaries/time_along_corr.Rds')

cor$time <- as.numeric(cor$time)
summary(cor$time)

```

# What is the age breakdown associated with each bear type?

```{r}

ind2 <- ind %>%
  mutate(age_class = 
           case_when(
             age < 5 ~ "Subadult",
             TRUE ~ "Adult"
           ))
kable(table(ind2$age_class, ind2$bear_type))

```

# What is the reproductive status associated with each bear type?

```{r}

kable(table(ind2$repro, ind2$bear_type)[c(2,1,3),])

```

# Look at time spent 

```{r}
ind3 <- select(ind2, id, year, age, repro, bear_type, age_class)

bpt2 <- bpt %>%
  left_join(ind3)

bpt2 %>%
  group_by(repro) %>%
  summarize(mean(time_spent))
  
bpt2 %>%
  group_by(age_class) %>%
  summarize(mean(time_spent))

```







Because the bonepile acts as a focal attractant, we predict bears will exhibit distinct behavior when foraging at the bonepile relative to other activities (i.e., resting or traveling along the coastal corridor). 

To separate 'bonepile' locations from others, we plotted net-squared distance (NSD) values over time for each individual, expecting the following patterns (adapted from Bunnefeld et al. 2011 - PROVIDE HYPERLINK): 

  * Coast & Bonepile Bears = Bears with 'dispersing' NSD patterns
    + These bears typically arrive on land and travel along the coast to the bonepile,
    | or arrive at the bonepile and then travel along the coast after they leave
    
  * Bonepile-only Bears = Bears with 'home range' NSD patterns
    + These bears arrive at the bonepile and do not leave for the duration of the study
    
  * Coast Bears = Bears who do not visit any bonepiles
    + These bears can exhibit any type of NSD pattern

We then validated our methodology by mapping the geographic locations of each category of point, and also identified animals who a) arrived on land directly at the bonepile or b) stayed for an extended time in a location that was not the bonepile. 

[insert NSD plot here]


After conducting NSD analysis, we can validate the methodology visually by mapping the two types of points

```{r}

## Could make three-part static plot if I have time with bp points, corridor points, and both

nsd <- readRDS('./Data/Derived-data/DFs/bears_ch2_092122.Rds') # df with at_bonepile

bones <- st_read('./Data/Spatial/Bonepiles/bonepiles.shp') %>% # bonepile shp
  st_transform(3338)

nsd <- st_as_sf(nsd) %>% # make into sf object
  st_set_crs(3338) 

nsd$at_bonepile <- as.factor(nsd$at_bonepile) # so legend shows 0 and 1 rather than 0-1 continuous scale

tmap_mode('view') # interactive map

tm_shape(bones) + 
  tm_dots(col = "blue", size = 0.5) + 
  tm_shape(nsd) + 
  tm_dots(col = "at_bonepile")

```






